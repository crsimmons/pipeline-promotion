---
platform: linux

inputs:
  - name: pipeline-promotion
  - name: build-metadata

outputs:
  - name: resource-versions

params:
  CONCOURSE_URL:
  CONCOURSE_USERNAME:
  CONCOURSE_PASSWORD:

run:
  path: bash
  args:
  - "-euc"
  - |
    source pipeline-promotion/tasks/fly-login.sh

    export ATC_BEARER_TOKEN=$(bosh int --path /targets/ci/token/value ~/.flyrc)

    stopover.v2 ${CONCOURSE_URL} ${BUILD_TEAM_NAME} ${BUILD_PIPELINE_NAME} ${BUILD_JOB_NAME} ${BUILD_NAME} > resource-versions/versions.yml
